@page "/"

@inject SqlDataAccess _db

@if (ObsGroups == null)
{
    <p>Loading...</p>
}
else
{
    <EditForm class="form-group" Model="@newObs" OnValidSubmit="SaveData">
        <div class="form-group">
            @foreach (ObservationViewModel obs in ObsList)
            {
                <ObservationComponent Obs="@obs"></ObservationComponent>
            }
        </div>
    </EditForm>
    @*<Observation @bind-value="@grp1" GrpId="g1" GrpText="Personal Protective Equipment" Observations="grp1"></Observation>
      <Observation GrpId="g2" GrpText="Tools & Equipment" Observations="grp2"></Observation>*@
}


@code {
    private List<ObservationGroupModel> ObsGroups;
    private List<ObservationModel> obsItems;
    public List<ObservationViewModel> ObsList=new List<ObservationViewModel>();
    private ObservationModel newObs = new ObservationModel();



    protected override async Task OnInitializedAsync()
    {
        try
        {
            ObsGroups = await _db.GetObservationGroups("");
            foreach (ObservationGroupModel grp in ObsGroups)
            {
                obsItems = await _db.GetObservations(grp.GrpId.ToString());
                ObservationViewModel ovm = new ObservationViewModel();
                ovm.GrpId = grp.GrpId;
                ovm.GrpText = grp.GrpText;
                ovm.observations = obsItems;
                ObsList.Add(ovm);
            }

        }
        catch (Exception e)
        {
            throw new Exception(e.Message);
        }
    }
    private void SaveData()
    {
        @*@foreach (ObservationModel obs in grp1)
            {
                Console.WriteLine(obs.Comment);
            }*@

    }

    //    private List<ObservationModel> grp1 = new List<ObservationModel>()
    //{
    //        new ObservationModel {ObsText = "1.1 Hearing Protection"},
    //        new ObservationModel {ObsText = "1.2 Hand Protection" }
    //    };

    //    private List<ObservationModel> grp2 = new List<ObservationModel>()
    //{
    //        new ObservationModel {ObsText = "2.1 Hearing Protection"},
    //        new ObservationModel {ObsText = "2.2 Hand Protection" }
    //    };
}
